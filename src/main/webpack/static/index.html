<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Ronan Boxer" />
  <title>Example</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cover-page">
<p><img src="assets/cover_image.png"></img> <a href="#">Learn more about courses here</a></p>
</div>
<div class="cover-page cover-text">
<div class="type">
Activity Guide
</div>
<div class="title">
My Course Title
</div>
<div class="creator">
The Merge Company
</div>
</div>
<div class="page-break">

</div>
<div class="copyright">
©2021 ACME. All rights reserved. </br> </br></br> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer et ullamcorper ipsum, in efficitur mi. Ut vitae velit et orci eleifend elementum. Sed vestibulum tortor lacus, eu aliquet velit luctus fermentum. Suspendisse non sapien nec arcu volutpat accumsan vehicula eget mi. Interdum et malesuada fames ac ante ipsum primis in faucibus. Donec sit amet finibus diam. Vivamus malesuada eu massa pulvinar viverra. Aliquam accumsan ultrices ornare. Etiam sed elementum odio. </br></br> Pellentesque aliquam scelerisque libero quis rutrum. Fusce id est eu mi vestibulum auctor quis at eros. Sed quis nulla id mi lacinia sagittis ut eget tellus. Ut id posuere odio. Morbi ornare pellentesque ex, ut cursus est. Pellentesque interdum faucibus neque at sollicitudin. Maecenas dui quam, sollicitudin eget tempus eget, consequat non metus. Fusce tristique ex sapien, euismod fermentum purus ultrices quis. Integer sagittis ligula eu ex malesuada, ut auctor felis condimentum. </br></br> Nunc egestas quam id nibh feugiat, placerat dapibus lectus varius. Pellentesque ultrices cursus blandit. In ut odio orci. Sed nec bibendum elit. Etiam et ipsum sed urna auctor venenatis at sit amet diam. In cursus sem nulla, et vulputate dolor auctor eget. Nunc est nisi, viverra quis tortor eget, vulputate commodo mi. Proin efficitur semper lacus ut tincidunt. Nam mauris ligula, cursus sed aliquet sit amet, lobortis vel dolor. </br></br> Morbi et dolor aliquam, dapibus lectus vel, varius risus. Donec lacus metus, pretium in commodo ut, fermentum sit amet quam. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Vestibulum aliquam ex sodales odio porttitor, sollicitudin pulvinar arcu consectetur. Donec dictum ultrices sem quis condimentum. Phasellus sodales lacus sollicitudin, efficitur odio at, sagittis neque. Sed leo ligula, luctus id dignissim a, dapibus sit amet nibh. Pellentesque rutrum mollis ultrices. Morbi a diam iaculis, pellentesque est efficitur, placerat massa. Praesent sit amet ligula nec quam tincidunt commodo. </br></br> Donec nec libero id lorem suscipit elementum. Phasellus dui purus, finibus eget massa imperdiet, posuere lobortis magna. Aenean hendrerit enim id ligula dignissim, ac euismod turpis vehicula. Vivamus ullamcorper risus euismod lectus faucibus molestie quis eget nulla. Sed maximus lorem non varius interdum. Aliquam orci eros, varius a mauris sit amet, varius aliquet lectus. Fusce porttitor nisi lectus, consectetur tincidunt libero dapibus sed. Quisque sed justo lobortis risus porttitor elementum id in nisi. </br></br></br></br>
<div class="last-updated">
10/22/2022
</div>
</div>
<div class="page-break">

</div>
<div class="toc">
<div>
Course Contents
</div>
<p><!-- START auto-update --> <!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> <!-- END auto-update --></p>
<ul>
<li><a href="#module-1-first-module-title-h1">Module 1: First Module Title (H1)</a>
<ul>
<li><a href="#list-examples-h3">List Examples (H3)</a></li>
<li><a href="#table-quote-and-hyperlink-examples-h3">Table, Quote, and Hyperlink Examples (H3)</a></li>
<li><a href="#code-block-and-code-snippet-examples-h3">Code block and Code Snippet examples (H3)</a></li>
<li><a href="#exercise-1-example-exercise-h2">Exercise 1: Example Exercise (H2)</a></li>
<li><a href="#workflow-purge-task-h2">Workflow Purge Task (H2)</a></li>
<li><a href="#exercise-2-configure-a-purge-task-h2">Exercise 2: Configure a Purge Task (H2)</a></li>
<li><a href="#exercise-3-create-a-monthy-window-h2">Exercise 3: Create a Monthy Window (H2)</a></li>
</ul></li>
<li><a href="#module-2-second-module-title">Module 2: Second Module Title</a>
<ul>
<li><a href="#tasks">Tasks</a></li>
<li><a href="#configure">Configure</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#exercise-1-update-aem">Exercise 1: Update AEM</a></li>
<li><a href="#workflow-purge-task">Workflow Purge Task</a></li>
<li><a href="#exercise-2-my-configuration-task">Exercise 2: My Configuration Task</a></li>
</ul></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<p><!-- END auto-update --></p>
</div>
<div class="page-break">

</div>
<h1 id="module-1-first-module-title-h1">Module 1: First Module Title (H1)</h1>
<p>This is the introduction to this module. After the introduction, there is a module table of contents that provides quick links to all topics and exercises in this module. If the student came to this module on accident, there is a secondary link “..back to the course table of contents” that lets the student go back to the global TOC.</p>
<h4 id="objectives-h4">Objectives (H4)</h4>
<ul>
<li>Lorem Ipsum
<ul>
<li>Lorem Ipsum</li>
</ul></li>
<li>Lorem Ipsum</li>
</ul>
<!-- START auto-update -->
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<h4 id="module-contents">Module Contents</h4>
<ul>
<li><a href="#module-1-first-module-title-h1">Module 1: First Module Title (H1)</a>
<ul>
<li><a href="#list-examples-h3">List Examples (H3)</a></li>
<li><a href="#table-quote-and-hyperlink-examples-h3">Table, Quote, and Hyperlink Examples (H3)</a></li>
<li><a href="#code-block-and-code-snippet-examples-h3">Code block and Code Snippet examples (H3)</a></li>
<li><a href="#exercise-1-example-exercise-h2">Exercise 1: Example Exercise (H2)</a></li>
<li><a href="#workflow-purge-task-h2">Workflow Purge Task (H2)</a></li>
<li><a href="#exercise-2-configure-a-purge-task-h2">Exercise 2: Configure a Purge Task (H2)</a></li>
<li><a href="#exercise-3-create-a-monthy-window-h2">Exercise 3: Create a Monthy Window (H2)</a></li>
</ul></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<a href="#course-contents">Return to Course Contents</a> <!-- END auto-update -->
<div class="page-break">

</div>
<h3 id="list-examples-h3">List Examples (H3)</h3>
<p>My First List</p>
<ul>
<li>Unordered 1
<ul>
<li>Unordered 2
<ul>
<li>Unordered 3
<ul>
<li>Unordered 4</li>
</ul></li>
</ul></li>
</ul></li>
<li>Unordered 5</li>
</ul>
<p>My Second List</p>
<ul>
<li>Unordered 1
<ul>
<li>Unordered 2</li>
</ul></li>
<li>Unordered 3</li>
</ul>
<p>My Third List</p>
<ol type="1">
<li>Ordered 1
<ol type="1">
<li>Ordered 2
<ol type="1">
<li>Ordered 3</li>
<li>Ordered 4</li>
</ol></li>
<li>Ordered 5</li>
</ol></li>
<li>Ordered 6</li>
</ol>
<h3 id="table-quote-and-hyperlink-examples-h3">Table, Quote, and Hyperlink Examples (H3)</h3>
<p><a href="https://docs.adobe.com/content/help/en/experience-manager-cloud-service/operations/maintenance.html">Link Example</a> are processes that run on a schedule in order to optimize the repository. With AEM as a Cloud Service, the need for customers to configure the operational properties of maintenance tasks is minimal. Customers can focus their resources on application-level concerns, leaving the infrastructure operations to Adobe. <a href="https://docs.adobe.com/content/help/en/experience-manager-65/administering/operations/operations-audit-log.html">Link Example 2</a></p>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 8%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Task</th>
<th style="text-align: left;">Owner</th>
<th style="text-align: left;">How to configure (optional)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Datastore garbage collection</td>
<td style="text-align: left;">Adobe</td>
<td style="text-align: left;">N/A - fully Adobe owned</td>
</tr>
<tr class="even">
<td style="text-align: left;">Version Purge</td>
<td style="text-align: left;">Adobe</td>
<td style="text-align: left;">Window owned by Adobe and OSGi configuration owned by customer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Audit Log Purge</td>
<td style="text-align: left;">Adobe</td>
<td style="text-align: left;">Window owned by Adobe and OSGi configuration owned by customer</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ad-hoc Task Purge</td>
<td style="text-align: left;">Customer</td>
<td style="text-align: left;">Maintenance Window and OSGi Configuration</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Workflow Purge</td>
<td style="text-align: left;">Customer</td>
<td style="text-align: left;">Maintenance Window and OSGi Configuration</td>
</tr>
<tr class="even">
<td style="text-align: left;">Project Purge</td>
<td style="text-align: left;">Customer</td>
<td style="text-align: left;">Maintenance Window and OSGi Configuration</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>NOTE</strong> This is a very nice note.</p>
</blockquote>
<h3 id="code-block-and-code-snippet-examples-h3">Code block and Code Snippet examples (H3)</h3>
<p>OSGi confgurations allow for a maintenance task to be configured specific to the business requirements for purging content. Code block: <code>/apps/example/components</code></p>
<p>Code Snippet</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="ot">jcr:root</span> <span class="er">xmlns:sling</span><span class="ot">=</span><span class="st">&quot;http://sling.apache.org/jcr/sling/1.0&quot;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  xmlns:jcr=</span><span class="st">&quot;http://www.jcp.org/jcr/1.0&quot;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  jcr:primaryType=</span><span class="st">&quot;sling:Folder&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  sling:configCollectionInherit=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ot">  sling:configPropertyInherit=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ot">  windowSchedule=</span><span class="st">&quot;daily&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ot">  windowStartTime=</span><span class="st">&quot;03:00&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ot">  windowEndTime=</span><span class="st">&quot;05:00&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> /&gt;</span></code></pre></div>
<h4 id="example-h4">Example H4</h4>
<p>The Maintenance UI can be used to easily configure the windows on a local AEM instance and them syncronzied back into the AEM project to be checked into source control. Alternatively, you can add and edit the xml files directly.</p>
<h5 id="example-h5">Example H5</h5>
<p>The Maintenance UI can be used to easily configure the windows on a local AEM instance and them syncronzied back into the AEM project to be checked into source control. Alternatively, you can add and edit the xml files directly.</p>
<h2 id="exercise-1-example-exercise-h2">Exercise 1: Example Exercise (H2)</h2>
<p><strong>Scenario</strong>: Your company has started using AEM projects to help support new products being added to your website. To maintain the performance in AEM, you need to purge the unused projects that users might have abandoned or are no longer needed. Because projects are used so often, purging needs to be performed daily.</p>
<p>Prerequisites:</p>
<ul>
<li>AEM running</li>
</ul>
<ol type="1">
<li><p>Go to Tools &gt; Operations &gt; Maintenance</p></li>
<li><p>Click on the <strong>Daily Maintenance Window</strong> card.</p></li>
<li><p>Image with Return, tab, and &lt; img &gt; with zoom 15% <img src="assets/sample-image.png" alt="sample-image" style="zoom: 15%;" /></p></li>
<li><p>Image with NO Return and &lt; img &gt; <img src="assets/sample-image.png" alt="sample-image" /></p></li>
<li><p>Image with Return, tab, and ! [] () <img src="assets/sample-image.png" alt="sample-image" /></p></li>
<li><p>Image with NO Return and ! [] () <img src="assets/sample-image.png" alt="sample-image" /></p></li>
<li><p>Image with Return only and &lt; img &gt; <img src="assets/sample-image.png" alt="sample-image" /></p></li>
<li><p>Image with 2 Returns and &lt; img &gt;</p>
<p><img src="assets/sample-image.png" alt="sample-image" /></p></li>
<li><p>From the dropdown, select <strong>Project Purge</strong> and click <strong>Save</strong></p></li>
<li><p>The bottom of the Project Purge card specifies when it will run next. For testing purposes, you can manually start the task immeditately.</p></li>
<li><p>Hover over the card and click the <strong>play</strong> button. Notice how the purge task fails. This is because it has not been configured yet.</p></li>
</ol>
<blockquote>
<p><strong>Congratulations!</strong> You have successfully created a daily purge task within a maintenance window.</p>
</blockquote>
<h2 id="workflow-purge-task-h2">Workflow Purge Task (H2)</h2>
<p>Minimizing the number of workflow instances increases the performance of the workflow engine, so you can regularly purge completed or running workflow instances from the repository.</p>
<p>Configure <strong>Adobe Granite Workflow Purge Configuration</strong> to purge workflow instances according their age and status. You can also purge workflow instances of all models or of a specific model .</p>
<p><img src="assets/sample-image.png" alt="sample-image" style="zoom: 15%;" /></p>
<p>You can also create multiple configurations of the service to purge workflow instances that satisfy different criteria. For example, create a configuration that purges the instances of a particular workflow model when they are running for much longer than the expected time. Create another configuration that purges all completed workflows after a certain number of days to minimize the size of the repository.</p>
<h2 id="exercise-2-configure-a-purge-task-h2">Exercise 2: Configure a Purge Task (H2)</h2>
<p><strong>Scenario:</strong> In AEM, runtime workflow models are stored in <code>/var/workflows/models/</code>. In this exercise you will configure a workflow purge task for the Adobe provide Publish Example workflow to purge completed workflows that are older than 30 days.</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>AEM running</li>
<li>Eclipse with a Maven Project imported</li>
</ul>
<h4 id="task-1-create-osgi-config-h4">Task 1: Create OSGi Config (H4)</h4>
<ol type="1">
<li>In AEM, navigate to <strong>Tools &gt; Operations &gt; Web Console</strong></li>
<li>In the configuration console find the <strong>Adobe Granite Workflow Purge Configuration</strong> factory &gt; <strong>Hint</strong> Use the browser find feature (crtl+f) to quickly find the configuration</li>
</ol>
<blockquote>
<p><strong>Note</strong> a factory configuration means you can have multiple instances of the configuration</p>
</blockquote>
<ol start="3" type="1">
<li>Click on the the configuration factory and observe the different options of the configuration:</li>
</ol>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Option Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">scheduledpurge.name</td>
<td style="text-align: center;">Name that shows up in the logs</td>
</tr>
<tr class="even">
<td style="text-align: center;">scheduledpurge.workflowStatus</td>
<td style="text-align: center;">COMPLETED/RUNNING</td>
</tr>
<tr class="odd">
<td style="text-align: center;">scheduledpurge.modelIds</td>
<td style="text-align: center;">List of models to purge</td>
</tr>
<tr class="even">
<td style="text-align: center;">scheduledpurge.daysold</td>
<td style="text-align: center;">Age of models to purge</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note</strong> The Factory Persistance Identity (PID) will also be needed to create the json config file.</p>
</blockquote>
<ol start="4" type="1">
<li><p>Keep this browser window open to observe the configuration file against these configurations.</p></li>
<li><p>Open your project in Eclipse.</p></li>
<li><p>Since configurations are considered immutable content, navigate to <strong>devops.ui.apps &gt; src/main/content/jcr_root &gt; apps &gt; training</strong></p></li>
<li><p>Right click on <strong>config.author</strong> and select <strong>New &gt; File</strong> <img src="assets/sample-image.png" alt="sample-image" style="zoom: 15%;" /></p></li>
<li><p>Enter <strong>com.adobe.granite.workflow.purge.Scheduler~training.cfg.json</strong> as the file name and click <strong>Finish.</strong></p></li>
<li><p>The file will open in the editor. In the <strong>Exercise Files</strong>, navigate to <strong>training-files/Maintenanc</strong>e and copy the contents of <strong>com.adobe.granite.workflow.purge.Scheduler~training.cfg.json</strong></p>
<blockquote>
<p><strong>Note</strong> This purge task has <strong>daysold</strong> set to 0 to show the purge task successfully running in the next task.</p>
</blockquote></li>
<li><p>Verify the file contents verify against the configuration in the web console in the browser. <strong>Save</strong> your changes in the Eclipse editor.</p></li>
</ol>
<h4 id="task-2-install-and-verify-the-purge-configuration-h4">Task 2: Install and verify the purge configuration (H4)</h4>
<ol type="1">
<li>In the Project Explorer, right-click <strong>devops-training</strong> and select <strong>Run As &gt; Maven Build</strong>. The build starts.</li>
<li>Verify that the build completed successfully</li>
<li>In AEM, navigate to <strong>Tools &gt; Operations &gt; Web Console</strong></li>
<li>In the configuration console find the <strong>Adobe Granite Workflow Purge Configuration</strong> factory. There should now be an instance of the factory called <strong>com.adobe.granite.workflow.purge.Scheduler~training</strong>. Open it.</li>
<li>Notice the configurations you added to the JSON file are now properly configured.</li>
<li>To observe the purge task successfully running, you will need to complete a Publish Example workflow. Navigate to the <strong>Sites Console</strong></li>
<li>Select <strong>WKND Site &gt; Create &gt; Workflow</strong>
<ol type="1">
<li>Workflow model = Publish Example</li>
<li>Workflow Title = Publish WKND</li>
<li>Select <strong>Next</strong></li>
<li>Select <strong>Create</strong></li>
</ol></li>
<li>The workflow has successfully started. To complete the workflow, Go to the <strong>Inbox</strong> in the top right corner (bell icon) and click <strong>View all</strong>.</li>
<li>Select the work item, <strong>Validate Content</strong> and click <strong>Complete</strong>.</li>
<li>Click <strong>Ok</strong> in the popup to complete the work item. The page publishes and the workflow is complete.</li>
<li>Verify the Completed workflow by going to <strong>Tools &gt; Workflow &gt; Archive</strong>. Observe the completed workflow.</li>
<li>You can manually kick off maintenance tasks outside the normal maintenance window for testing purposes. Navigate to <strong>Tools &gt; Operations &gt; Maintenance</strong></li>
<li>Click on <strong>Weekly Maintenance Window</strong>. On the <strong>Workflow Purge</strong> card, click the <strong>play</strong> button.</li>
<li>You will see the card go from yellow to green when the task is complete. To verify the purge successfully occurred, navigate back to <strong>Tools &gt; Workflow &gt; Archive</strong> and notice the archived Publish Example workflow instance no longer exists.</li>
</ol>
<blockquote>
<p><strong>Congratulations!</strong> You have successfully configured a purge task and tested it successfully.</p>
</blockquote>
<h2 id="exercise-3-create-a-monthy-window-h2">Exercise 3: Create a Monthy Window (H2)</h2>
<p><strong>Scenario:</strong> Your company has started using ad-hoc tasks and you want to make sure older tasks are properly removed from the system. This is not a widely used feature and purging old tasks is not top priority. You want to create a monthly maintenance window to purge any tasks out of compliance with the out of the box ad-hoc task purge configuration. This configuration purges completed tasks older than 30 days and active tasks older than 90 days. See <code>com.adobe.granite.taskmanagement.impl.purge.TaskPurgeMaintenanceTask</code> in the web console.</p>
<p>Prerequisites:</p>
<ul>
<li>AEM running</li>
</ul>
<ol type="1">
<li>In AEM, Navigate to <strong>Tools &gt; General &gt; CRXDE Lite</strong></li>
<li>In the JCR tree on the left, navigate to <strong>/libs/settings/granite/operations/maintenance</strong></li>
<li>Copy the <strong>granite_weekly</strong> node and paste it under <strong>/conf/global/settings/granite/operations/maintenance</strong></li>
<li>Save.</li>
<li>Under <strong>/conf/global/settings/granite/operations/maintenance</strong> delete the 3 nodes under <strong>granite_weekly</strong> and <strong>Save</strong>.</li>
<li>Rename <strong>granite_weekly</strong> to <strong>granite_monthly</strong> and <strong>Save</strong></li>
<li>Select <strong>granite_monthly</strong> and in the properties pane on the bottom right, update the <strong>windowSchedule</strong> to <strong>monthy</strong> and <strong>Save</strong>.</li>
<li>At this point we can use the Maintenance UI to complete the window. In AEM, navigate to <strong>Tools &gt; Operations &gt; Maintenance</strong></li>
<li>Hover over <strong>Monthly Maintenance Window</strong> and click the <strong>Configure gears.</strong></li>
<li>Change the start and end days to <strong>Friday</strong> and <strong>Save</strong></li>
<li>Click on the <strong>Monthly Maintenance Window</strong> to open it.</li>
<li>Click the <strong>Add</strong> icon.</li>
<li>Select <strong>Purge of ad-hoc tasks</strong> and <strong>Save</strong>.</li>
</ol>
<blockquote>
<p><strong>Congratulations</strong>! You have successfully added the ad-hoc purge task to a monthly maintenance window.</p>
</blockquote>
<h1 id="module-2-second-module-title">Module 2: Second Module Title</h1>
<p>This is the introduction to this module. After the introduction, there is a module table of contents that provides quick links to all topics and exercises in this module. If the student came to this module on accident, there is a secondary link “..back to the course table of contents” that lets the student go back to the global TOC.</p>
<h4 id="objectives">Objectives</h4>
<ul>
<li>Lorem Ipsum</li>
<li>Lorem Ipsum</li>
</ul>
<!-- START auto-update -->
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<h4 id="module-contents-1">Module Contents</h4>
<ul>
<li><a href="#module-2-second-module-title">Module 2: Second Module Title</a>
<ul>
<li><a href="#tasks">Tasks</a></li>
<li><a href="#configure">Configure</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#exercise-1-update-aem">Exercise 1: Update AEM</a></li>
<li><a href="#workflow-purge-task">Workflow Purge Task</a></li>
<li><a href="#exercise-2-my-configuration-task">Exercise 2: My Configuration Task</a></li>
</ul></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<p><a href="#course-contents">Return to Course Contents</a> <!-- END auto-update --></p>
<h3 id="tasks">Tasks</h3>
<p><a href="www.something.com">Another Task</a> are processes that run on a schedule in order to optimize the repository. With AEM as a Cloud Service, the need for customers to configure the operational properties of maintenance tasks is minimal. Customers can focus their resources on <a href="www.something.com">application-level concerns</a>, leaving the infrastructure operations to Adobe.</p>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 8%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Task</th>
<th style="text-align: left;">Owner</th>
<th style="text-align: left;">How to configure (optional)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Datastore garbage collection</td>
<td style="text-align: left;">Adobe</td>
<td style="text-align: left;">N/A - fully Adobe owned</td>
</tr>
<tr class="even">
<td style="text-align: left;">Version Purge</td>
<td style="text-align: left;">Adobe</td>
<td style="text-align: left;">Window owned by Adobe and OSGi configuration owned by customer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Audit Log Purge</td>
<td style="text-align: left;">Adobe</td>
<td style="text-align: left;">Window owned by Adobe and OSGi configuration owned by customer</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ad-hoc Task Purge</td>
<td style="text-align: left;">Customer</td>
<td style="text-align: left;">Maintenance Window and OSGi Configuration</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Workflow Purge</td>
<td style="text-align: left;">Customer</td>
<td style="text-align: left;">Maintenance Window and OSGi Configuration</td>
</tr>
<tr class="even">
<td style="text-align: left;">Project Purge</td>
<td style="text-align: left;">Customer</td>
<td style="text-align: left;">Maintenance Window and OSGi Configuration</td>
</tr>
</tbody>
</table>
<h3 id="configure">Configure</h3>
<p>OSGi confgurations allow for a maintenance task to be configured specific to the business requirements for purging content.</p>
<ul>
<li>Version Purge Configuration</li>
<li>Audit Log Configuration</li>
</ul>
<h3 id="windows">Windows</h3>
<p>Workflow Purge, Ad-hoc Task Purge and Project Purge Maintenance tasks to be executed during the daily, weekly, or monthly maintenance windows. These configurations should be added directly in source control.</p>
<h4 id="daily-configuration-example">Daily Configuration Example</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="ot">jcr:root</span> <span class="er">xmlns:sling</span><span class="ot">=</span><span class="st">&quot;http://sling.apache.org/jcr/sling/1.0&quot;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  xmlns:jcr=</span><span class="st">&quot;http://www.jcp.org/jcr/1.0&quot;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  jcr:primaryType=</span><span class="st">&quot;sling:Folder&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  sling:configCollectionInherit=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ot">  sling:configPropertyInherit=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ot">  windowSchedule=</span><span class="st">&quot;daily&quot;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ot">  windowStartTime=</span><span class="st">&quot;03:00&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ot">  windowEndTime=</span><span class="st">&quot;05:00&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a> /&gt;</span></code></pre></div>
<p>The Maintenance UI can be used to easily configure the windows on a local AEM instance and them syncronzied back into the AEM project to be checked into source control. Alternatively, you can add and edit the xml files directly.</p>
<h2 id="exercise-1-update-aem">Exercise 1: Update AEM</h2>
<p><strong>Scenario</strong>: Your company has started using AEM projects to help support new products being added to your website. To maintain the performance in AEM, you need to purge the unused projects that users might have abandoned or are no longer needed. Because projects are used so often, purging needs to be performed daily.</p>
<p>Prerequisites:</p>
<ul>
<li>AEM running</li>
</ul>
<ol type="1">
<li>Go to Tools &gt; Operations &gt; Maintenance</li>
<li>Click on the <strong>Daily Maintenance Window</strong> card.</li>
<li>Select the <strong>+ Add</strong> button <img src="assets/sample-image.png" alt="sample-image" style="zoom: 15%;" /></li>
<li>From the dropdown, select <strong>Project Purge</strong> and click <strong>Save</strong></li>
<li>The bottom of the Project Purge card specifies when it will run next. For testing purposes, you can manually start the task immeditately.</li>
<li>Hover over the card and click the <strong>play</strong> button. Notice how the purge task fails. This is because it has not been configured yet.</li>
</ol>
<p><strong>Congratulations!</strong> You have successfully created a daily purge task within a maintenance window.</p>
<h2 id="workflow-purge-task">Workflow Purge Task</h2>
<p>Minimizing the number of workflow instances increases the performance of the workflow engine, so you can regularly purge completed or running workflow instances from the repository.</p>
<p>Configure <strong>Adobe Granite Workflow Purge Configuration</strong> to purge workflow instances according their age and status. You can also purge workflow instances of all models or of a specific model .</p>
<p><img src="assets/sample-image.png" alt="sample-image" style="zoom: 15%;" /></p>
<p>You can also create multiple configurations of the service to purge workflow instances that satisfy different criteria. For example, create a configuration that purges the instances of a particular workflow model when they are running for much longer than the expected time. Create another configuration that purges all completed workflows after a certain number of days to minimize the size of the repository.</p>
<h2 id="exercise-2-my-configuration-task">Exercise 2: My Configuration Task</h2>
<p><strong>Scenario:</strong> In AEM, runtime workflow models are stored in <code>/var/workflows/models/</code>. In this exercise you will configure a workflow purge task for the Adobe provide Publish Example workflow to purge completed workflows that are older than 30 days.</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>AEM running</li>
<li>Eclipse with a Maven Project imported</li>
</ul>
<h4 id="task-1-create-osgi-config">Task 1: Create OSGi Config</h4>
<ol type="1">
<li>In AEM, navigate to <strong>Tools &gt; Operations &gt; Web Console</strong></li>
<li>In the configuration console find the <strong>Adobe Granite Workflow Purge Configuration</strong> factory &gt; <strong>Hint</strong>: Use the browser find feature (crtl+f) to quickly find the configuration</li>
</ol>
<blockquote>
<p><strong>Note</strong>: a factory configuration means you can have multiple instances of the configuration</p>
</blockquote>
<ol start="3" type="1">
<li>Click on the the configuration factory and observe the different options of the configuration:</li>
</ol>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Option Name</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">scheduledpurge.name</td>
<td style="text-align: center;">Name that shows up in the logs</td>
</tr>
<tr class="even">
<td style="text-align: center;">scheduledpurge.workflowStatus</td>
<td style="text-align: center;">COMPLETED/RUNNING</td>
</tr>
<tr class="odd">
<td style="text-align: center;">scheduledpurge.modelIds</td>
<td style="text-align: center;">List of models to purge</td>
</tr>
<tr class="even">
<td style="text-align: center;">scheduledpurge.daysold</td>
<td style="text-align: center;">Age of models to purge</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note</strong>: The Factory Persistance Identity (PID) will also be needed to create the json config file.</p>
</blockquote>
<ol start="4" type="1">
<li><p>Keep this browser window open to observe the configuration file against these configurations.</p></li>
<li><p>Open your project in Eclipse.</p></li>
<li><p>Since configurations are considered immutable content, navigate to <strong>devops.ui.apps &gt; src/main/content/jcr_root &gt; apps &gt; training</strong></p></li>
<li><p>Right click on <strong>config.author</strong> and select <strong>New &gt; File</strong> <img src="assets/sample-image.png" alt="sample-image" style="zoom: 15%;" /></p></li>
<li><p>Enter <strong>com.adobe.granite.workflow.purge.Scheduler~training.cfg.json</strong> as the file name and click <strong>Finish.</strong></p></li>
<li><p>The file will open in the editor. In the <strong>Exercise Files</strong>, navigate to <strong>training-files/Maintenanc</strong>e and copy the contents of <strong>com.adobe.granite.workflow.purge.Scheduler~training.cfg.json</strong></p>
<blockquote>
<p><strong>Note</strong>: This purge task has <strong>daysold</strong> set to 0 to show the purge task successfully running in the next task.</p>
</blockquote></li>
<li><p>Verify the file contents verify against the configuration in the web console in the browser. <strong>Save</strong> your changes in the Eclipse editor.</p></li>
</ol>
<h4 id="task-2-install-and-verify-the-purge-configuration">Task 2: Install and verify the purge configuration</h4>
<ol type="1">
<li>In the Project Explorer, right-click <strong>devops-training</strong> and select <strong>Run As &gt; Maven Build</strong>. The build starts.</li>
<li>Verify that the build completed successfully</li>
<li>In AEM, navigate to <strong>Tools &gt; Operations &gt; Web Console</strong></li>
<li>In the configuration console find the <strong>Adobe Granite Workflow Purge Configuration</strong> factory. There should now be an instance of the factory called <strong>com.adobe.granite.workflow.purge.Scheduler~training</strong>. Open it.</li>
<li>Notice the configurations you added to the JSON file are now properly configured.</li>
<li>To observe the purge task successfully running, you will need to complete a Publish Example workflow. Navigate to the <strong>Sites Console</strong></li>
<li>Select <strong>WKND Site &gt; Create &gt; Workflow</strong>
<ol type="1">
<li>Workflow model = Publish Example</li>
<li>Workflow Title = Publish WKND</li>
<li>Select <strong>Next</strong></li>
<li>Select <strong>Create</strong></li>
</ol></li>
<li>The workflow has successfully started. To complete the workflow, Go to the <strong>Inbox</strong> in the top right corner (bell icon) and click <strong>View all</strong>.</li>
<li>Select the work item, <strong>Validate Content</strong> and click <strong>Complete</strong>.</li>
<li>Click <strong>Ok</strong> in the popup to complete the work item. The page publishes and the workflow is complete.</li>
<li>Verify the Completed workflow by going to <strong>Tools &gt; Workflow &gt; Archive</strong>. Observe the completed workflow.</li>
<li>You can manually kick off maintenance tasks outside the normal maintenance window for testing purposes. Navigate to <strong>Tools &gt; Operations &gt; Maintenance</strong></li>
<li>Click on <strong>Weekly Maintenance Window</strong>. On the <strong>Workflow Purge</strong> card, click the <strong>play</strong> button.</li>
<li>You will see the card go from yellow to green when the task is complete. To verify the purge successfully occurred, navigate back to <strong>Tools &gt; Workflow &gt; Archive</strong> and notice the archived Publish Example workflow instance no longer exists.</li>
</ol>
<p><strong>Congratulations!</strong> You have successfully configured a purge task and tested it successfully.</p>
</body>
</html>